---
import 'wipe.css'
import Header from '~/components/Header.astro'
import generateCssVariables from '~/utils/generateCssVariables'

export type Props = {
  headerTitle?: string | null
  background?: string | null
  foreground?: string | null
}

const props = Astro.props as Props
const { headerTitle, background, foreground } = props

const wrapperStyle = generateCssVariables({ background, foreground })
---

<html lang='en' data-js='false'>
  <head>
    <meta charset='utf-8' />
    <meta name='viewport' content='width=device-width' />
    <title>Astro</title>

    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.webmanifest">

    <script is:inline>
      if (typeof window.queueMicrotask !== 'function') {
        window.queueMicrotask = callback => Promise.resolve().then(callback)
      }
    </script>
    <script is:inline>
      const onLoadImage = element => {
        element.setAttribute('data-loaded', 'true')
        element.removeEventListeneer(onLoadImage)
      }
      const handleImageLoad = element => {
        if (element.complete) return element.setAttribute('data-loaded', 'true')
        element.addEventListener('load', onLoadImage)
      }
      window.handleImageLoad = handleImageLoad
    </script>
    <script is:inline>
      const switchDataJSAttribute = () => document.documentElement.setAttribute('data-js', 'true')
      window.addEventListener('load', switchDataJSAttribute)
    </script>
  </head>
  <body style={wrapperStyle}>
    <Header title={headerTitle} />
    <slot />
  </body>
</html>

<style is:global>
  body {
    color: var(--foreground);
    background-color: var(--background);
    font-family: sans-serif;
  }
</style>
